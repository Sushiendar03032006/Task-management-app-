<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taskify | Professional Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .active-link { color: #4f46e5; border-bottom: 2px solid #4f46e5; }
        /* Scrollable Chart Wrapper */
        .chart-container { width: 100%; overflow-x: hidden; scroll-behavior: smooth; border-radius: 1rem; }
        .chart-area { min-width: 1000px; height: 320px; }
        .nav-btn { background: white; border: 1px solid #e5e7eb; padding: 0.5rem; border-radius: 9999px; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .nav-btn:hover { background: #f9fafb; color: #4f46e5; }
        .nav-btn:active { transform: scale(0.9); }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 transition-colors duration-500 font-sans">

    <nav class="bg-white/95 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200">
        <div class="max-w-5xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-2xl animate-pulse">üìã</span>
                <h1 class="text-xl font-extrabold tracking-tighter text-gray-900 leading-none">TASKIFY<span class="text-indigo-600">.</span></h1>
            </div>
            
            <div class="flex items-center gap-4 sm:gap-8">
                <button onclick="showPage('tasksPage', this)" class="nav-link active-link font-bold text-sm uppercase">Tasks</button>
                <button onclick="showPage('statsPage', this)" class="nav-link text-gray-500 font-bold text-sm uppercase transition">Insights</button>
                <button id="themeToggle" class="p-2 nav-btn border-none shadow-none text-xl">üåô</button>
                <button id="logoutBtn" class="bg-red-50 text-red-600 px-4 py-1.5 rounded-lg text-xs font-black uppercase hover:bg-red-100 transition">Logout</button>
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto p-4 sm:p-8">
        
        <div class="mb-10 text-left animate-in fade-in slide-in-from-top-4 duration-700">
            <h2 class="text-white text-3xl sm:text-5xl font-black drop-shadow-lg tracking-tight">
                Welcome, <span id="userNameDisplay" class="text-yellow-300">Guest</span> üëã
            </h2>
            <p class="text-indigo-100 font-medium mt-2 opacity-90 text-lg">Here's your productivity overview for today.</p>
        </div>

        <section id="tasksPage">
            <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-2xl p-6 sm:p-10 border border-white/20">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-black text-gray-800">My Workspace</h2>
                    <div class="text-right">
                        <span id="taskCount" class="block text-sm font-bold text-indigo-600">0 Tasks</span>
                        <button id="clearCompleted" class="text-xs text-gray-400 underline hover:text-red-500 transition">Clear Done</button>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-3 mb-8">
                    <input id="taskInput" type="text" placeholder="Capture a new task..." 
                        class="flex-1 bg-gray-50 border-2 border-transparent focus:border-indigo-500 focus:bg-white p-4 rounded-2xl outline-none transition-all shadow-inner text-lg">
                    <button id="addBtn" class="bg-indigo-600 text-white px-8 py-4 rounded-2xl font-black shadow-lg hover:bg-indigo-700 transition transform active:scale-95">ADD</button>
                </div>

                <div class="space-y-4 mb-8">
                    <input id="searchInput" type="text" placeholder="Search your list..." class="w-full p-3 rounded-xl border bg-white/50 focus:bg-white transition">
                    
                    <div class="flex flex-col gap-2">
                        <div class="flex justify-between items-end">
                            <div class="flex gap-2">
                                <button class="tabBtn px-4 py-1.5 rounded-full bg-indigo-600 text-white text-xs font-bold" data-filter="all">All</button>
                                <button class="tabBtn px-4 py-1.5 rounded-full bg-gray-100 text-gray-500 text-xs font-bold" data-filter="active">Active</button>
                                <button class="tabBtn px-4 py-1.5 rounded-full bg-gray-100 text-gray-500 text-xs font-bold" data-filter="completed">Done</button>
                            </div>
                            <span id="progressPercent" class="text-lg font-black text-indigo-600">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden shadow-inner">
                            <div id="progressBar" class="bg-gradient-to-r from-green-400 to-emerald-500 h-full transition-all duration-1000" style="width:0%"></div>
                        </div>
                    </div>
                </div>

                <ul id="taskList" class="space-y-4"></ul>
                <div id="emptyState" class="hidden text-center py-12 text-gray-400 font-medium">No tasks found! üöÄ</div>
            </div>
        </section>

        <section id="statsPage" class="hidden animate-in slide-in-from-bottom-5 duration-500">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-black text-white drop-shadow-md">Analytics Dashboard</h2>
                <button id="exportCsvBtn" class="flex items-center gap-2 bg-emerald-600 text-white px-6 py-2.5 rounded-xl font-bold shadow-lg hover:bg-emerald-700 transition transform active:scale-95">
                    Export to CSV
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="md:col-span-2 bg-white/90 rounded-3xl p-8 shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-black text-gray-800 text-xl">üìà Productivity Trend</h3>
                        <div class="flex gap-2">
                            <button onclick="scrollChart('trendScroll', -300)" class="nav-btn">‚ùÆ</button>
                            <button onclick="scrollChart('trendScroll', 300)" class="nav-btn">‚ùØ</button>
                        </div>
                    </div>
                    <div class="chart-container" id="trendScroll">
                        <div class="chart-area" id="trendWrapper"><canvas id="taskChart"></canvas></div>
                    </div>
                </div>

                <div class="md:col-span-2 bg-white/90 rounded-3xl p-8 shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-black text-gray-800 text-xl">üî• Priority Distribution</h3>
                        <div class="flex gap-2">
                            <button onclick="scrollChart('priorityScroll', -300)" class="nav-btn">‚ùÆ</button>
                            <button onclick="scrollChart('priorityScroll', 300)" class="nav-btn">‚ùØ</button>
                        </div>
                    </div>
                    <div class="chart-container" id="priorityScroll">
                        <div class="chart-area" id="priorityWrapper"><canvas id="priorityChart"></canvas></div>
                    </div>
                </div>

                <div class="bg-white/90 rounded-3xl p-8 shadow-xl flex flex-col items-center">
                    <h3 class="font-bold text-gray-700 mb-6 uppercase tracking-widest text-sm">üéØ Success Ratio</h3>
                    <div class="h-64 w-full"><canvas id="pieChart"></canvas></div>
                </div>

                <div class="bg-white/90 rounded-3xl p-8 shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-gray-700 uppercase tracking-widest text-sm">üìä Daily Volume</h3>
                        <div class="flex gap-2">
                            <button onclick="scrollChart('volumeScroll', -300)" class="nav-btn">‚ùÆ</button>
                            <button onclick="scrollChart('volumeScroll', 300)" class="nav-btn">‚ùØ</button>
                        </div>
                    </div>
                    <div class="chart-container" id="volumeScroll">
                        <div class="chart-area" id="volumeWrapper"><canvas id="barChart"></canvas></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="task.js"></script>

    <script>
        function showPage(pageId, btn) {
            document.getElementById('tasksPage').classList.toggle('hidden', pageId !== 'tasksPage');
            document.getElementById('statsPage').classList.toggle('hidden', pageId !== 'statsPage');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active-link', 'text-indigo-600'));
            btn.classList.add('active-link');
        }

        function scrollChart(containerId, amount) {
            const container = document.getElementById(containerId);
            container.scrollLeft += amount;
        }

        const commonOpt = { 
            responsive: true, maintainAspectRatio: false, 
            plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, font: { weight: 'bold' } } } },
            scales: { x: { ticks: { autoSkip: true, maxTicksLimit: 12 } } }
        };
        
        const taskChart = new Chart(document.getElementById("taskChart"), { type: "line", data: { labels: [], datasets: [{ label: "Completed", borderColor: "#10b981", tension: 0.4, data: [] }, { label: "Pending", borderColor: "#6366f1", tension: 0.4, data: [] }] }, options: commonOpt });
        const priorityChart = new Chart(document.getElementById("priorityChart"), { type: "bar", data: { labels: [], datasets: [{ label: "High", backgroundColor: "#ef4444", data: [] }, { label: "Medium", backgroundColor: "#f59e0b", data: [] }, { label: "Low", backgroundColor: "#3b82f6", data: [] }] }, options: { ...commonOpt, scales: { x: { ...commonOpt.scales.x, stacked: true }, y: { stacked: true } } } });
        const barChart = new Chart(document.getElementById("barChart"), { type: "bar", data: { labels: [], datasets: [{ label: "Task Volume", data: [], backgroundColor: [] }] }, options: commonOpt });
        const pieChart = new Chart(document.getElementById("pieChart"), { type: "doughnut", data: { labels: ["Done", "Left"], datasets: [{ backgroundColor: ["#10b981", "#6366f1"], data: [0,0], borderWidth: 0 }] }, options: { ...commonOpt, cutout: '75%' } });

        window.updateChart = (dateCounts, done, pending, priorityData) => {
            const dates = Object.keys(dateCounts).sort();
            const dynamicWidth = Math.max(1000, dates.length * 60) + "px";
            ['trendWrapper', 'priorityWrapper', 'volumeWrapper'].forEach(id => document.getElementById(id).style.width = dynamicWidth);

            taskChart.data.labels = dates;
            taskChart.data.datasets[0].data = dates.map(d => dateCounts[d].completed);
            taskChart.data.datasets[1].data = dates.map(d => dateCounts[d].pending);
            taskChart.update();

            priorityChart.data.labels = dates;
            priorityChart.data.datasets[0].data = dates.map(d => priorityData[d]?.high || 0);
            priorityChart.data.datasets[1].data = dates.map(d => priorityData[d]?.medium || 0);
            priorityChart.data.datasets[2].data = dates.map(d => priorityData[d]?.low || 0);
            priorityChart.update();

            barChart.data.labels = dates;
            const vols = dates.map(d => dateCounts[d].completed + dateCounts[d].pending);
            barChart.data.datasets[0].data = vols;
            barChart.data.datasets[0].backgroundColor = vols.map(v => v > 5 ? "#ef4444" : "#f472b6");
            barChart.update();

            pieChart.data.datasets[0].data = [done, pending];
            pieChart.update();
        };
    </script>

    <footer class="bg-white/80 backdrop-blur-md border-t border-gray-200 py-6 mt-12">
        <div class="max-w-5xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
            
            <div class="flex items-center gap-2">
                <span class="text-xl">üìã</span>
                <p class="text-sm font-bold text-gray-500">
                    &copy; 2026 <span class="text-indigo-600 font-black">TASKIFY.</span> 
                    <span class="hidden sm:inline">All rights reserved.</span>
                </p>
            </div>

            <div class="text-center">
                <p class="text-xs font-medium text-gray-400 uppercase tracking-widest">
                    Built with <span class="text-red-500">‚ù§Ô∏è</span> for 
                    <span class="text-gray-600 font-bold">Productivity</span>
                </p>
            </div>

           
        </div>
    </footer>
</body>
</html>